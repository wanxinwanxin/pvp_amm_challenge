[pytest]
# Pytest configuration for economic correctness test suite

# ============================================================================
# Test Discovery
# ============================================================================

# Test file patterns
python_files = test_*.py *_test.py

# Test class patterns
python_classes = Test* *Tests

# Test function patterns
python_functions = test_*

# Directories to search for tests
testpaths = tests

# Directories to ignore
norecursedirs = .git .tox dist build *.egg contracts node_modules .venv venv

# ============================================================================
# Markers
# ============================================================================

markers =
    backward_compat: Backward compatibility tests comparing old vs new system
    economic: Core economic property tests (symmetry, arbitrage, accounting, etc.)
    edge_case: Edge case and stress tests with extreme inputs
    integration: Integration tests spanning multiple components
    slow: Tests taking more than 5 seconds to run

# ============================================================================
# Output Formatting
# ============================================================================

# Console output verbosity
# -v: verbose, -vv: more verbose, -q: quiet
addopts =
    -ra
    --strict-markers
    --strict-config
    --showlocals
    --tb=short

# Minimum Python version required
minversion = 7.0

# ============================================================================
# Coverage Settings
# ============================================================================

# Coverage options (when using --cov)
# Configured via setup.cfg or pyproject.toml for better organization

# ============================================================================
# Warnings
# ============================================================================

# Filter warnings
filterwarnings =
    error
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ImportWarning

# ============================================================================
# Output Control
# ============================================================================

# Show summary of all test outcomes
# a: all except passed
# r: reason for skip/xfail
console_output_style = progress

# Show extra test summary info
# f: failed, E: error, s: skipped, x: xfailed, X: xpassed
# See -r option in addopts above

# ============================================================================
# Logging
# ============================================================================

# Log level for tests
log_level = INFO

# Log format for console output
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Log format for file output
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# Performance
# ============================================================================

# Timeout for individual tests (requires pytest-timeout)
# timeout = 60

# ============================================================================
# Doctest
# ============================================================================

# Doctest options (for running doctests in docstrings)
doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS

# ============================================================================
# Custom Options
# ============================================================================

# Economic test specific tolerances (accessed via config in tests)
# These can be overridden via command line: pytest --decimal-tolerance=1e-8

# Decimal precision tolerance
# decimal_tolerance = 1e-10

# Percentage tolerance for relative comparisons
# percentage_tolerance = 0.0001

# Convergence tolerance for iterative routing
# convergence_tolerance = 0.001
